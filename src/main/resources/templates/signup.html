<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>sign up</title>
    <link rel="stylesheet" href="./css/signup.css" type="text/css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>
<body>
<h1>Sign Up</h1> <hr>

<form th:action="@{/main}" method="POST">

    <div class="email_input_box" id="email_check_false" >

        email : <input type="text" name="email" class="email_input" disabled = "disabled"><br>
        <div>
            <span>인증번호 전송</span>
        </div>
        <div class="clearfix"></div>
    </div>

    password : <input type="password" name="password"> <br>

    <!--닉네임 중복 검사-->
    <div class="form-group">
        <label for="user_id">닉네임</label>
        <input type="text" class="form-control" id="user_id" name="name" placeholder="ID" required>
        <div class="check_font" id="id_check"></div>
    </div>

    addr :
    <input id="member_addr" type="text" name="addr" placeholder="Address" style="width: 200px" readonly onclick="findAddr()"> <br>

    취미 :  <select name="hobby">
        <option value="운동">운동</option>
        <option value="독서">독서</option>
        <option value="영화">영화</option>
        <option value="여행">여행</option>
        <option value="이야기">이야기</option>
    </select> <br>
    auth: <input type="radio" name="auth" value="ROLE_ADMIN,ROLE_USER"> admin
    <input type="radio" name="auth" value="ROLE_USER" checked="checked"> user <br>
    <button type="submit">Join</button>
</form> <br>

<a href="/login">Go to login →</a>

</body>
<script>
    function findAddr(){
        new daum.Postcode({
            oncomplete: function(data) {

                var roadAddr = data.roadAddress; // 도로명 주소 변수
                var jibunAddr = data.jibunAddress; // 지번 주소 변수
                // 우편번호와 주소 정보를 해당 필드에 넣는다.
                if(roadAddr !== ''){
                    document.getElementById("member_addr").value = roadAddr;
                }
                else if(jibunAddr !== ''){
                    document.getElementById("member_addr").value = jibunAddr;
                }
            }
        }).open();
    }
</script>
<script>
    $(".mail_check_button").click(function(){
        var email = $(".email_input").val();        // 입력한 이메일

        $.ajax({
            type:"GET",
            url:"mailCheck?email=" + email
        });
    });

    // 아이디 유효성 검사(1 = 중복 / 0 != 중복)
    $("#user_id").blur(function() {
        // id = "id_reg" / name = "userId"
        var user_id = $('#user_id').val();
        var idJ = /^[a-z0-9가-힣]{2,10}$/;
        $.ajax({
            url : '${pageContext.request.contextPath}/signup/idCheck?userId='+ user_id,
            type : 'get',
            success : function(data) {
                console.log("1 = 중복o / 0 = 중복x : "+ data);

                if (data == 1) {
                    // 1 : 아이디가 중복되는 문구
                    $("#id_check").text("사용중인 아이디입니다 :p");
                    $("#id_check").css("color", "red");
                    $("#reg_submit").attr("disabled", true);
                } else {

                    if(idJ.test(user_id)){
                        // 0 : 아이디 길이 / 문자열 검사
                        $("#id_check").text("");
                        $("#reg_submit").attr("disabled", false);

                    } else if(user_id == ""){

                        $('#id_check').text('아이디를 입력해주세요 :)');
                        $('#id_check').css('color', 'red');
                        $("#reg_submit").attr("disabled", true);

                    } else {

                        $('#id_check').text("아이디는 한글,소문자,숫자 2~10자리만 가능합니다:)");
                        $('#id_check').css('color', 'red');
                        $("#reg_submit").attr("disabled", true);
                    }

                }
            }, error : function() {
                console.log("실패");
            }
        });
    });
</script>
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
</html>